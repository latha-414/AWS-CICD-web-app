name: Auto Release and PR Info

on:
  push:
    branches:
      - main

permissions:
  contents: write
  pull-requests: read

jobs:
  release:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Get PR Information
        id: pr_info
        uses: cloudposse-github-actions/get-pr@main
        with:
          id: ${{ github.event.number }}
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Create Release
        uses: actions/create-release@v1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        with:
          tag_name: v${{ steps.pr_info.outputs.number }}
          release_name: Release ${{ steps.pr_info.outputs.number }}
          body: |
            **Title:** ${{ steps.pr_info.outputs.title }}
            **Author:** ${{ steps.pr_info.outputs.author }}
            **PR Number:** ${{ steps.pr_info.outputs.number }}
            **PR Description:** ${{ steps.pr_info.outputs.body }}
          draft: false
          prerelease: false
